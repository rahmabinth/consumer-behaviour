---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Rahma Binth Mohammad
thanks: "Code and data are available at: https://github.com/rahmabinth/consumer-behaviour"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(patchwork)
spending <-  read_csv(here::here("data/analysis_data/spending.csv"))
cpi <-  read_csv(here::here("data/analysis_data/cpi.csv"))
income <- read_csv(here::here("data/analysis_data/income.csv"))

total_ex_cpi <- read_csv(here::here("data/analysis_data/total_ex_cpi.csv")) 

```


# Introduction



# Data {#sec-data}
## Sources
A good indicator of inflation is the Consumer Price Index (CPI), as it measures the change in price using a fixed basket of goods and services. Statistics Canada is a government agency that collects information on Canada’s economy (cite). Thus, it has the data that provides the CPI for numerous years. Statistics Canada also provides us with other datasets such as the average household income and the average household expenditures, in a year for all the provinces. We have chosen to look at Ontario solely, as we hold firmly Ontario behaves very differently due to its high population in relation to the other provinces. The data for Canada as a whole is complicated as there are many missing values for some provinces. Our analysis and the data provided by Statistics Canada makes it possible to reproduce our model for different provinces using the github repository.  While there are other datasets available, these three datasets are provided by the same source and has data for provinces across Canada. The expenditure and cpi data also provides the information for three additional specific categories, food, shelter, and recreation, making it easier to isolate and answer our research question. @sec-variables will illustrate the visualised data.
 
This paper’s objective is to address the following questions using data collected from a government census: (1) Does changes in prices affect expenditure? (2) Does changed in prices affect expenditure as income changes?

### Spending Data

`spending.csv`

This dataset contains the average total expenditures of the Ontario resident for the years 2010 to 2021, excluding years 2018 and 2020. It also contains the breakdown of the expenditures, food purchased (from restaurant and stores), shelter (rented and owned), utilities such as water, fuel, and electricity for the principal accommodation, clothing, transportation (private and public), healthcare, recreational goods and services. 

### Inflation Data

`cpi.csv`

The dataset provides CPI for every year. It is not seasonally adjusted for changes as it is an annual average. Thus, it is actual price paid by consumers and not adjusted for seasonal fluctuations. The base year for the CPI calculation is 2002 where CPI is 100. Thus, if our CPI is 120 for a year, it indicates a 20% increase since 2002. This value is useful as an indicator for inflation, as it provides the increase and comparison between years, rather than a absolute price values. 

### Income Data

`income.csv`

Throughout the province of Ontario, there exits people in many different financial situations. Statistics Canada provides us with this dataset that contains the average number of people in an income category. For example, “persons with income under $5000", “persons with income of $5000 and over”, “persons with income of $10 000 and over.” Please note as for 2020, COVID-19 government income support and benefits are included in income estimates. 

## Methodology
The language and environment used for this analysis is R (R Core Team 2020), alongside the tidyverse (cite), rstanarm (cite), cansim (cite), knitr (cite), ggplot2 (cite), scales (cite), modelsummary (cite), and marginaleffects (cite) packages. 

We downloaded the data directly from Statistics Canada using the cansim package. We cleaned it, identified missing values and wrote csv files to make it easily accessible using R studio. 

## Variables {#sec-variables}

For our analysis, we have to use all three dataset values and thus, we chose to use data for the years 2010 to 2021, excluding 2018 and 2020, given the data was only available in all given datasets for these years. However our model does predict the behaviour in 2018 and 2020, using the other years’ data. We also created numerous csv files that isolated the specific data. @sec-appendix thoroughly explains the structure of the csv files.  


```{r}
#| label: fig-spending
#| fig-cap: Household spending per year
#| fig-align: "center"
#| echo: false
#| warning: false
#| message: false

#Plot spending categories for the years
spending_colours <- c(
  "Total expenditure" = "goldenrod3", 
  "Food" = "purple",
  "Shelter" = "green",
  "Recreation" = "blue")
ggplot(spending, aes(x = Year, y = VALUE, color = expenditure_categories, group = expenditure_categories)) +
  geom_line() +
  geom_point() +
  labs(
 
    x = "Year",
    y = "Expenditure Value ($)"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_color_manual(values = spending_colours, name = NULL) +
  scale_x_continuous(
    breaks = seq(2010, 2021, by = 2)) +
  scale_y_continuous(
      labels = scales::comma
    )
```
From the household spending dataset, we chose to select the values for all food expenditures, all shelter expenditures, recreation expenditures, and total expenditures. This choice was made because these are principal expenditures for everyone. Recreation was added to this mix, to identify how consumers behave when inflation is high. @fig-total_ex_cpi indicates this relationship. In @fig-spending, we observe a steady increase in recreation expenditures, while food, shelter, and overall expenditures show a more rapid growth. Note for simplicity, we did not include the other categories used for total expenditures. For all four of the categories, the mean and median values were close to each other, indicating the data is not skewed and did not have many outliers. However, the standard deviation for shelter and total expenditures were higher which indicates more money was spent and thus, more variation over the years. 

```{r}
#| label: fig-cpi
#| fig-cap: Consumer Price Index (CPI) per Year
#| fig-align: "center"
#| echo: false
#| warning: false
#| message: false

cpi_colours <- c(
  "All-items" = "goldenrod3", 
  "Food" = "purple",
  "Shelter" = "green",
  "Recreation" = "blue")

ggplot(cpi, aes(x = Year, y = VALUE, color = product_groups, group = product_groups)) +
  geom_line() +
  geom_point() +
  labs(
    x = "Year",
    y = "CPI",
  ) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_color_manual(values = cpi_colours, name = NULL) +
  scale_x_continuous(
    breaks = seq(2010, 2021, by = 2)) +
  scale_y_continuous(
    breaks = seq(100, 160, by = 10),
    limits = c(100, 160)
  )

```

From the CPI dataset, we chose to look at the annual average to keep it consistent with the annual average of expenditures. The variables 

```{r}
#| label: fig-income
#| fig-cap: Number of Income Earners
#| fig-align: "center"
#| echo: false
#| warning: false
#| message: false
#Plot the number of income earners against the year
ggplot(income, aes(x = Year, y = VALUE)) +
  geom_line(colour = "darkred") +
  geom_point(colour = "darkred") +
  labs(
    x = "Year",
    y = "Income Earners"
  ) +
  theme_minimal() +
  scale_x_continuous(
    breaks = seq(2010, 2021, by = 2)) +
  scale_y_continuous(
    labels = scales::comma,
    limits = c(9600000, 11250000)
  )

```

From the income dataset, we chose to isolate the values for the category “all persons with income”. This indicate all tax fillers and dependants that earn income from all sources. This was done to keep our analysis consistent. 


```{r}
#| label: fig-total_ex_cpi
#| fig-cap: CPI and total expenditure over the year
#| fig-align: "center"
#| echo: false
#| warning: false
#| message: false

ggplot(total_ex_cpi, aes(x = cpi, y = expenditure, color = factor(Year))) +
  geom_point(size = 1) +
  geom_line(linewidth = 0.5, aes(group = 1)) + # Connect the points with a line
  labs(
    x = "All-Items CPI",
    y = "Total Expenditure",
    color = "Year"
  ) +
  theme_minimal() +
  scale_color_viridis_d() +
  scale_x_continuous(
    limits = c(115, 145)) +
  scale_y_continuous(
    labels = scales::comma,
    limits = c(75000, 100000)
  )
```


# Model

The goal of our model is to forecasting the total expenditure in a household in a year, based solely on a the Consumer Price Index, and the number of people in Ontario earning an income. We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

### Simple linear regression
The model we employ is:

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \beta_0 + \beta_1 \times \mbox{cpi}_i + \epsilon\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

Where:

* $y_i$ as the total expenditure in Canadian dollars in year i. 
* $cpi_i$ is the annual Consumer Price Index (CPI) for year i

### Multiple linear regression
The model we employ is:

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \beta_0 + \beta_1 \times \mbox{cpi}_i + \beta_2 \mbox{income}_i+ \epsilon\\
\beta_0 &\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &\sim \mbox{Normal}(0, 2.5) \\
\beta_2 &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

Where:

* $y_i$ as the total expenditure in Canadian dollars in year i. 
* $cpi_i$ is the annual Consumer Price Index (CPI) for year i
* $income_i$ is the number of people in Ontario earning an income

### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


```{r}
#| label: fig-2
#| fig-cap: Linear model
#| echo: false
#| warning: false
#| message: false
library(scales)

total_ex_cpi |>
  ggplot(aes(x = cpi, y = expenditure, color = factor(Year))) +
  geom_point(size = 1) +
  geom_smooth(
    method = "lm",
    se = TRUE,
    color = "black",
    linetype = "dashed",
    formula = y ~ x
  ) +
  labs(
    title = "Total Expenditure vs All-Items CPI",
    x = "All-Items CPI",
    y = "Total Expenditure",
    color = "Year"
  ) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_viridis_d() +
  theme_minimal()
```


```{r}
#| label: fig-3
#| fig-cap: Linear model
#| echo: false
#| warning: false
#| message: false
library(scales)

total_ex_cpi |>
  ggplot(aes(x = cpi, y = expenditure, color = factor(Year))) +
  geom_point(size = 1) +
  geom_smooth(
    method = "lm",
    se = TRUE,
    color = "black",
    linetype = "dashed",
    formula = y ~ x
  ) +
  labs(
    title = "Total Expenditure vs All-Items CPI",
    x = "All-Items CPI",
    y = "Total Expenditure",
    color = "Year"
  ) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_viridis_d() +
  theme_minimal()
```
# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
second_model <-
  readRDS(file = here::here("models/second_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of "
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model,
    "Second model" = second_model
  ),
  statistic = "mad",
  fmt = 2
)
```

```{r}

```


# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {#sec-appendix}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check
